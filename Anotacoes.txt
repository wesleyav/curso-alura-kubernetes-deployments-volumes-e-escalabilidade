# Continuação do curso Kubernetes: Pods, Services e ConfigMaps

Pod
 - Caso falhe, é o fim da vida dele, não retorna
 - Como criar outro para assumir o lugar dele automaticamente?

Replica Set
 - estrutura que pode encapsular um ou mais pods

# Visualizar informações dos serviços
$ kubectl get svc

# Aplicar o arquivo
$ kubectl apply -f .\portal-noticias-replicaset.yaml

# Visualizar informações do pod
$ kubectl get pods

# Exibir o número de replicasets
$ kubectl get replicasets

# Exibir o número de replicasets em tempo real
$ kubectl get replicasets --watch

# Apagar o pod
$ kubectl delete pod portal-noticias-replicaset-p8564

# Com isso vemos que o replicaset cria outro pod automaticamente

#################################################

Deployment
 - camada acima dos replicaset´s
 - quando se define um deployment, define-se automaticamente um replicaset


# Aplicar o arquivo
$ kubectl apply -f .\nginx-deployment.yaml

# Visualizar informações do pod
$ kubectl get pods

# Exibir o número de replicasets
$ kubectl get replicasets

# Exibir o deployment
$ kubectl get deployments

# Exibir o status do controle de fluxo do deployment
# kubectl rollout history deployment nome-do-deployment
$ kubectl rollout history deployment nginx-deployment

# Aplicar o arquivo e altera o histórico do fluxo do deployment (como git)
$ kubectl apply -f .\nginx-deployment.yaml --record

# Visualizar informações do pod
$ kubectl get pods

# Exibir o status do controle de fluxo do deployment
# kubectl rollout history deployment nome-do-deployment
$ kubectl rollout history deployment nginx-deployment

# Definir uma anotação de alteração para exibir no status do controle de fluxo do deployment
# kubectl annotate deployment nome-do-deployment kubernetes.io/change-cause="mensagem de anotação"
$ kubectl annotate deployment nginx-deployment kubernetes.io/change-cause="Definindo a imagem com versão latest"

# Exibir o status do controle de fluxo do deployment
# kubectl rollout history deployment nome-do-deployment
$ kubectl rollout history deployment nginx-deployment

# Visualizar informações do pod
$ kubectl get pods

# Validar o pod
# kubectl describe pod nome-do-pod 
$ kubectl describe pod nginx-deployment-6645687878-ctsbw

# Voltar para a versão de uma alteração específica
# kubectl rollout undo deployment nome-do-deployment --to-revision=2
$ kubectl rollout undo deployment nginx-deployment --to-revision=2

#################################################

# Visualizar informações do pod
$ kubectl get pods

# Deletar o deployment
# kubectl delete deployment nome-do-deployment
$ kubectl delete deployment nginx-deployment

# Deletar o replicaset via arquivo
# kubectl delete -f nome-do-arquivo
$ kubectl delete -f .\portal-noticias-replicaset.yaml

# Aplicar o arquivo
$ kubectl apply -f .\portal-noticias-deployment.yaml

# Visualizar informações do pod
$ kubectl get pods

# Exibir o status do controle de fluxo do deployment
# kubectl rollout history deployment nome-do-deployment
$ kubectl rollout history deployment portal-noticias-deployment

# Definir uma anotação de alteração para exibir no status do controle de fluxo do deployment
# kubectl annotate deployment nome-do-deployment kubernetes.io/change-cause="mensagem de anotação"
$ kubectl annotate deployment portal-noticias-deployment kubernetes.io/change-cause="Criando portal de notícias na versão 1"

# Visualizar informações do pod
$ kubectl get pods

# Apagar o pod
$ kubectl delete pod sistema-noticias

# Aplicar o arquivo
$ kubectl apply -f .\sistema-noticias-deployment.yaml

# Visualizar informações do pod
$ kubectl get pods

# Apagar o pod
$ kubectl delete pod db-noticias

# Aplicar o arquivo
$ kubectl apply -f .\db-noticias-deployment.yaml

# Visualizar informações do pod
$ kubectl get pods

# Definir uma anotação de alteração para exibir no status do controle de fluxo do deployment
# kubectl annotate deployment nome-do-deployment kubernetes.io/change-cause="mensagem de anotação"
$ kubectl annotate deployment sistema-noticias-deployment kubernetes.io/change-cause="Subindo o sistema na versão 1"

# Exibir o status do controle de fluxo do deployment
# kubectl rollout history deployment nome-do-deployment
$ kubectl rollout history deployment sistema-noticias-deployment

# Definir uma anotação de alteração para exibir no status do controle de fluxo do deployment
# kubectl annotate deployment nome-do-deployment kubernetes.io/change-cause="mensagem de anotação"
$ kubectl annotate deployment db-noticias-deployment kubernetes.io/change-cause="Subindo o banco na versão 1"

# Exibir o status do controle de fluxo do deployment
# kubectl rollout history deployment nome-do-deployment
$ kubectl rollout history deployment db-noticias-deployment

# Acessar no navegador
# http://localhost:30001/

# Os dados inseridos sumiram!

#################################################